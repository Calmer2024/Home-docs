# 配环境教程

## Conda

Conda 是一个开源的包管理系统和环境管理系统，用于安装、运行和更新包及其依赖项。它能够轻松地在本地计算机上创建、保存、加载和切换环境。

### 第一步：下载最新版（推荐国内镜像）

不要去官网下载（太慢），直接去清华大学开源镜像站下载，速度快且稳定。

- **下载地址**：[清华大学 Miniconda 镜像列表](https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/)
- **选择文件**：
  - 往下拉，找到最新日期的版本（通常在最下面）。
  - 下载文件名包含 `Windows-x86_64` 的 `.exe` 文件（例如 `Miniconda3-py310_23.x.x-1-Windows-x86_64.exe`）。

### 第二步：安装 Miniconda（关键步骤）

双击下载好的安装包，注意以下几个细节：

1. **Just Me vs All Users**: 选 **Just Me** (推荐)。
2. **安装路径**:
   - 可以改回你习惯的 `D:\soft\dev\Miniconda3`。
   - **注意**：路径里**千万不要有中文**，也尽量不要有空格。
3. **Advanced Options (高级选项) —— 最重要的一步**: 你会看到几个勾选框，建议如下设置：
   - [ ] Create shortcuts... (默认勾选，保持勾选)
   - [ ] **Add Miniconda3 to my PATH environment variable** (**不要勾选！** 勾选这个虽然方便，但容易造成系统 DLL 冲突，导致你之前遇到的 SSL 错误。我们用专门的终端来运行它)。
   - [x] **Register Miniconda3 as my default Python 3.x** (推荐勾选)。
   - [ ] Clear the package cache... (不用管)。

点击 **Install** 等待完成。

### 第三步：配置镜像源（解决慢和报错的核心）

安装完成后，**先不要急着创建环境**，我们先把“网线”接好。

1. **打开终端**：

   - 在开始菜单搜索 `Anaconda Prompt (Miniconda3)`，点击打开。

2. **创建配置文件**：

   - 在黑色的窗口里输入以下命令并回车（这会生成一个默认的 `.condarc` 文件）：

     ```Bash
     conda config --set show_channel_urls yes
     ```

3. **修改配置文件** (最稳妥的方法)：

   - 去 `C:\Users\你的用户名\` 找到新生成的 `.condarc` 文件。
   - 用记事本打开，**清空里面的所有内容**。
   - 粘贴下面这段代码（我已经把协议改成了 `http` 以规避你之前的 SSL 证书报错，并关闭了 SSL 验证，这是目前国内网络环境下的万能配置）：

```yaml
channels:
  - defaults
show_channel_urls: true
ssl_verify: false
default_channels:
  - http://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main
  - http://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r
  - http://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2
custom_channels:
  conda-forge: http://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  msys2: http://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  bioconda: http://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  menpo: http://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  pytorch: http://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  pytorch-lts: http://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  simpleitk: http://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
```

1. **保存**并关闭文件。

### 第四步：创建 Python 3.9 环境

回到刚才打开的 `Anaconda Prompt` 黑窗口。

1. **清理缓存** (可选，保险起见)：

   ```Bash
   conda clean -i
   ```

2. **创建环境**：

   ```Bash
   conda create -n py39 python=3.9
   ```

   - 此时你应该会看到下载进度条跑得飞快，也不会再报错了。
   - 遇到 `Proceed ([y]/n)?` 输入 `y` 回车。

### 第五步：验证

1. **激活环境**：

   ```Bash
   conda activate py39
   ```

2. **检查版本**：

   ```Bash
   python --version
   ```

如果输出了 `Python 3.9.x`，恭喜你！你已经成功拥有了一个干净、可用的 Python 环境。现在你可以开始安装你需要的包了（比如 `pip install pandas`）。

### 扩展：配置新建环境到D盘

#### 第一步：修改 `.condarc` 配置文件

我们需要显式地告诉 Conda：“请把新环境优先安装到 D 盘”。

1. 再次打开 `C:\Users\28109\.condarc` 文件。
2. 在文件末尾添加 `envs_dirs` 配置项。
   - **注意：** 保持之前的镜像源配置不变，直接追加在后面即可。
   - **最终文件内容应该长得像这样**（注意缩进和你的实际路径）：

```yaml
channels:
  - defaults
show_channel_urls: true
ssl_verify: false
default_channels:
  - http://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main
  - http://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r
  - http://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2
custom_channels:
  conda-forge: http://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  msys2: http://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  bioconda: http://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  menpo: http://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  pytorch: http://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  pytorch-lts: http://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  simpleitk: http://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
envs_dirs:
  - D:\soft\dev\miniconda3\envs
```

**关键点解释：**

- `envs_dirs`: 这个配置项指定了环境的保存路径。
- 我们将 `D:\soft\dev\miniconda3\envs` 放在第一位，Conda 就会优先往这里存。

#### 第二步：解决文件夹权限问题（**至关重要**）

很多时候 Conda 即使配置了 D 盘，也会因为**没有权限写入**而自动回退到 C 盘。我们需要给 D 盘的安装目录开通权限。

1. 打开文件资源管理器，找到文件夹 `D:\soft\dev\`。
2. 右键点击 `miniconda3` 文件夹，选择 **“属性”**。
3. 点击 **“安全” (Security)** 选项卡。
4. 点击 **“编辑” (Edit)** 按钮。
5. 在“组或用户名”列表中，选中 **`Users`** （这代表普通用户组）。
6. 在下面的权限列表中，把 **“完全控制” (Full control)** 或者 **“修改” (Modify)** 打上勾。
7. 点击 **“确定”** 保存。

#### 第三步：迁移环境（删除旧的，新建新的）

因为你现在的 `py39` 还是空的或者刚建好，最快的方法是直接删了重来。

请在终端（Anaconda Prompt）中依次执行：

1. **退出当前环境**（如果还在里面）：

   ```bash
   conda deactivate
   ```

2. **删除 C 盘的旧环境**：

   ```bash
   conda remove -n py39 --all
   ```

3. **重新创建环境**：

   ```bash
   conda create -n py39 python=3.9
   ```

**验证时刻：** 当系统询问 `Proceed ([y]/n)?` 时，请仔细看一眼它列出的 **`Environment location:`**。 如果显示的是 `D:\soft\dev\miniconda3\envs\py39`，那就成功了！

输入 `y` 完成创建。

最后，你可以再次运行 `conda env list`，现在的输出应该是这样：

```
# conda environments:
#
base                     D:\soft\dev\miniconda3
py39                  * D:\soft\dev\miniconda3\envs\py39
```

这样所有的包都会乖乖待在 D 盘了。